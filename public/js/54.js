(self.webpackChunk=self.webpackChunk||[]).push([[54],{54:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var i=s(757),r=s.n(i);function a(e,t,s,i,r,a,n){try{var o=e[a](n),d=o.value}catch(e){return void s(e)}o.done?t(d):Promise.resolve(d).then(i,r)}const n={name:"Couriers",data:function(){return{dialog:!1,dialogDelete:!1,loading:!0,headers:[{text:"#",value:"index"},{text:"Имя",value:"name"},{text:"Телефон",value:"phone",sortable:!1},{text:"Номер машины",value:"car",sortable:!1},{text:"Действия",value:"actions",sortable:!1}],couriers:[],editedIndex:-1,editedItem:{id:null,name:"",phone:"",car:"",password:""},defaultItem:{id:0,name:null,phone:null,car:null,password:null},errors:[]}},created:function(){this.fetchCouriers()},methods:{fetchCouriers:function(){var e,t=this;return(e=r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.get("/api/couriers").then((function(e){var s;console.log(e,"fetch"),t.couriers=null!==(s=e.data.data)&&void 0!==s?s:[]})).catch((function(e){console.log(e)})).finally((function(){return t.loading=!1}));case 2:case"end":return e.stop()}}),e)})),function(){var t=this,s=arguments;return new Promise((function(i,r){var n=e.apply(t,s);function o(e){a(n,i,r,o,d,"next",e)}function d(e){a(n,i,r,o,d,"throw",e)}o(void 0)}))})()},editItem:function(e){this.editedIndex=this.couriers.indexOf(e),this.editedItem=Object.assign({},e),this.editedItem.id=e.id,this.editedItem.password="1",this.dialog=!0},editPass:function(e){this.$router.push("couriers/"+e.id)},deleteItem:function(e){this.editedIndex=this.couriers.indexOf(e),this.editedItem=Object.assign({},e),this.editedItem.id=e.id,this.dialogDelete=!0},deleteItemConfirm:function(){var e=this;axios.delete("/api/couriers/"+this.editedItem.id).then((function(t){e.close(),t.data.status?(e.$store.dispatch("showAlert",{isVisible:!0,msg:t.data.message,color:"green",type:"success"}),e.fetchCouriers()):e.$store.dispatch("showAlert",{isVisible:!0,msg:t.data.message,color:"error",type:"error"})})).catch((function(t){e.$store.commit("SET_ALERT",{isVisible:!0,msg:t.message,color:"error",type:"error"})})),this.close()},close:function(){var e=this;this.dialog=!1,this.dialogDelete=!1,this.$nextTick((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}))},getPhone:function(){return this.editedItem.phone?this.editedItem.phone.replace(/[^0-9]/g,""):""},save:function(){var e=this,t=this.getPhone(),s="/api/couriers/";this.editedIndex>-1&&(s+=this.editedItem.id),axios.post(s,{name:this.editedItem.name,phone:t,car:this.editedItem.car,password:this.editedItem.password}).then((function(t){e.close(),e.$store.dispatch("showAlert",{isVisible:!0,msg:t.data.message,color:t.data.status?"green":"error",type:t.data.status?"success":"error"}),e.fetchCouriers()})).catch((function(t){e.errors=t.response.data.errors}))}}};const o=(0,s(900).Z)(n,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.couriers,loading:e.loading,"loading-text":"Loading... Please wait"},scopedSlots:e._u([{key:"item.index",fn:function(t){var s=t.index;return[e._v("\n        "+e._s(s+1)+"\n    ")]}},{key:"top",fn:function(){return[s("v-toolbar",{attrs:{flat:""}},[s("v-toolbar-title",[e._v("Курьеры")]),e._v(" "),s("v-divider",{staticClass:"mx-4",attrs:{inset:"",vertical:""}}),e._v(" "),s("v-spacer"),e._v(" "),s("v-dialog",{attrs:{"max-width":"600px"},scopedSlots:e._u([{key:"activator",fn:function(t){var i=t.on,r=t.attrs;return[s("v-btn",e._g(e._b({staticClass:"mb-2",attrs:{color:"primary",dark:""}},"v-btn",r,!1),i),[e._v("\n                        Добавить\n                    ")])]}}]),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[e._v(" "),s("v-card",[s("v-card-title",[s("span",{staticClass:"text-h5"},[e._v("Курьер")])]),e._v(" "),s("v-card-text",[s("v-container",[s("v-row",[s("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[s("v-text-field",{attrs:{label:"Имя","error-messages":e.errors.name},model:{value:e.editedItem.name,callback:function(t){e.$set(e.editedItem,"name","string"==typeof t?t.trim():t)},expression:"editedItem.name"}})],1),e._v(" "),s("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[s("v-text-field",{directives:[{name:"mask",rawName:"v-mask",value:"+7 (###) ###-##-##",expression:"'+7 (###) ###-##-##'"}],attrs:{label:"Телефон","error-messages":e.errors.phone},model:{value:e.editedItem.phone,callback:function(t){e.$set(e.editedItem,"phone",t)},expression:"editedItem.phone"}})],1),e._v(" "),s("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[s("v-text-field",{attrs:{label:"Номер машины"},model:{value:e.editedItem.car,callback:function(t){e.$set(e.editedItem,"car",t)},expression:"editedItem.car"}})],1),e._v(" "),s("v-col",{attrs:{cols:"12",sm:"6",md:"4"}},[-1===e.editedIndex?s("v-text-field",{attrs:{label:"Пароль","error-messages":e.errors.password},model:{value:e.editedItem.password,callback:function(t){e.$set(e.editedItem,"password",t)},expression:"editedItem.password"}}):e._e()],1)],1)],1)],1),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v("\n                            Отмена\n                        ")]),e._v(" "),s("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.save}},[e._v("\n                            Сохранить\n                        ")])],1)],1)],1),e._v(" "),s("v-dialog",{attrs:{"max-width":"500px"},model:{value:e.dialogDelete,callback:function(t){e.dialogDelete=t},expression:"dialogDelete"}},[s("v-card",[s("v-card-title",{staticClass:"text-h5"},[e._v("Вы уверены, что хотите удалить?")]),e._v(" "),s("v-card-actions",[s("v-spacer"),e._v(" "),s("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.close}},[e._v("Отмена")]),e._v(" "),s("v-btn",{attrs:{color:"blue darken-1",text:""},on:{click:e.deleteItemConfirm}},[e._v("OK")]),e._v(" "),s("v-spacer")],1)],1)],1)],1)]},proxy:!0},{key:"item.actions",fn:function(t){var i=t.item;return[s("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(i)}}},[e._v("\n            mdi-pencil\n        ")]),e._v(" "),s("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editPass(i)}}},[e._v("\n            mdi-lock\n        ")]),e._v(" "),s("v-icon",{attrs:{small:""},on:{click:function(t){return e.deleteItem(i)}}},[e._v("\n            mdi-delete\n        ")])]}}])})}),[],!1,null,null,null).exports}}]);